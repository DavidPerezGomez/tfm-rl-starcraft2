#!/bin/bash

if [ -z "${SRC_DIR}" ]; then echo "Environmental variable SRC_DIR needs to be configured. Check the README for more info."; exit 1; fi
if [ -z "${MODELS_DIR}" ]; then echo "Environmental variable MODELS_DIR needs to be configured. Check the README for more info."; exit 1; fi

MODEL_SUBDIR="RandomBaseline"

AGENT_TYPE="multi"
AGENT_ALGORITHM="random"
AGENT_SUBTYPE="army_recruit_manager"
REWARD_MODE="score"

AGENT_KEY="${AGENT_TYPE}.${AGENT_ALGORITHM}.${AGENT_SUBTYPE}"
MODEL_ID="${AGENT_TYPE}_${AGENT_ALGORITHM}_${AGENT_SUBTYPE}_${REWARD_MODE}"

EXPERIMENT_DIR="${MODELS_DIR}/${MODEL_SUBDIR}"
MODEL_DIR="${EXPERIMENT_DIR}/${MODEL_ID}"
LOG_SUFFIX=""

MAP=BuildMarinesFixed
EPISODES=150

mkdir -p "${MODEL_DIR}"

echo "Exploiting ${AGENT_KEY} on ${MAP}"
touch "${MODEL_DIR}"/_01_exploiting_start_${TRAIN_EPISODES}_ep

python "${SRC_DIR}"/runner.py \
      --agent_key "${AGENT_KEY}" \
      --model_id "${MODEL_ID}" \
      --map_name "${MAP}" \
      --num_episodes ${EPISODES} \
      --exploit \
      --action_masking \
      --reward_mode ${REWARD_MODE} \
      --score_method ${SCORE_MODE} \
      --models_path "${EXPERIMENT_DIR}" \
      --log_file "exploit${LOG_SUFFIX}.log" \
      --export_stats_only \
      --novisualize \
      2>&1 | tee "${MODEL_DIR}"/${MAP}${LOG_SUFFIX}.log

touch "${MODEL_DIR}"/_02_exploiting_done_${TRAIN_EPISODES}_ep